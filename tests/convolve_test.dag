
// Is this what idiomatic DAG looks like? 
// Who knows.
// Indexing is a part of life, as it turns out.
// We can't really get around it. 
// Except that we _can_ require it to be computable at compile time.
// 
// All arguments to tabulate must be either a compile time constant 
// or an expression composed only of constants and dim_ calls. 
// *Maybe* temps with constant values. No function calls.
// 
// Why is this comment in this test?

// Convolves with a filter.
float[][] convolve (float[][] source,float[][] mask){
  return parallel (int i <- tabulate(1,dim0(source) - 1,1)){
    return parallel (int j <- tabulate(1,dim1(source) - 1,1)){
      float[] temp = parallel (int k <- tabulate (-1,2,1)) {
        float ii = source[i+k][j-1] * mask[k+1][0];
        float ij = source[i+k][j]   * mask[k+1][1];
        float ik = source[i+k][j+1] * mask[k+1][2];
        return ii + ij + ik;
      };
      return reduce(+,0.0,temp);
    };
  };
}

// Box Blur =
// { { 0.111, 0.111, 0.111 }, 
//   { 0.111, 0.111, 0.111 },  
//   { 0.111, 0.111, 0.111 } }

// Gaussian Blur = 
// { { 0.060, 0.130, 0.060 }, 
//  { 0.130, 0.250, 0.130 },  
//  { 0.060, 0.130, 0.060 } }

// Horiztonal Edge Detect = 
// { { 1.0,  0 , -1.0 }, 
//   { 1.0,  0 , -1.0 },  
//   { 1.0,  0 , -1.0 } }

// Vertical Edge Detect = 
// { {  1.0,  1.0 ,  1.0 }, 
//   {   0 ,   0  ,   0  },  
//   { -1.0, -1.0 , -1.0 } }

// General Edge Detect

//  0  1  0 
//  1 -8  1 
//  0  1  0 

// Sharpen

//  0 -1  0
// -1  5 -1
//  0 -1  0


